function comprobarLogin(){
	
	let barraNav = document.querySelector('#barraNav');
	let ls = document.querySelector('#labelSeguidos');
	let bs = document.querySelector('#botonSeguidos');
	let lv = document.querySelector('#labelVenta');
	let bv = document.querySelector('#botonVenta');
	if(sessionStorage['usuario']!=null){
		let usuario = JSON.parse(sessionStorage['usuario']).login;
		barraNav.innerHTML = `<li>
					<a href="index.html">
						<span class="icon-home"></span>
						<span>Inicio</span>
					</a>
				</li>
				<li>
					<a onclick="logout();">
						<span class="icon-user-times"></span>
						<span>Logout (${usuario})</span>
					</a>
				</li>
				<li>
					<a href="nuevo.html">
						<span class="icon-doc-new"></span>
						<span>Nuevo articulo</span>
						</a>
				</li>
				`;
	}else{
		barraNav.innerHTML = `<li>
					<a href="index.html">
						<span class="icon-home"></span>
						<span>Inicio</span>
					</a>
				</li>
				<li>
					<a href="login.html">
						<span class="icon-login"></span>
						<span>Login</span>
					</a>
				</li>
				<li>
					<a href="registro.html">
						<span class="icon-user-plus"></span>
						<span>Registro</span>
					</a>
				</li>`;
		ls.style.display = 'none';
		bs.style.display = 'none';
		lv.style.display = 'none';
		bv.style.display = 'none';
	}
}

function logout(){
	sessionStorage.clear();
	window.location = "/pcw_practicas/index.html";
}

function cargarCategorias(){
	let xhr = new XMLHttpRequest(),
		url = 'api/categorias';

	xhr.open('GET',url,true);

	xhr.onerror = function(){
		console.log('Error cargando categorias');
	};

	xhr.onload = function(){
		let r = JSON.parse(xhr.responseText);
		r.FILAS.forEach( function(e) {
			let option = document.createElement('option');
			option.innerHTML = `${e.nombre}`;
			document.querySelector('#lista-categorias').appendChild(option);
		});
	};

	xhr.send();
}



function nombreCatId(){
	let cat  = document.getElementById('lista-categorias').value;
	let hacerelse = true;
	let xhr = new XMLHttpRequest(),
		url = 'api/categorias';

	xhr.open('GET',url,true);

	xhr.onerror = function(){
		console.log('Error sabiendo categorias');
	}

	xhr.onload = function(){
		let r = JSON.parse(xhr.responseText);
		r.FILAS.forEach( function(e) {
			if(e.nombre == cat){
				hacerBusqueda('',e.id);
				hacerelse = false;
			}
		});
		if(hacerelse){
			hacerBusqueda('','-');
		}
	};
	xhr.send();
	return false;
}


function establecerBusqueda(){
	let urlCoger = window.location.search;

	if(urlCoger==null || urlCoger == ""){
	}else{
		urlArray = urlCoger.split('=');
		if (urlArray[0]=="?t") {
			busqueda = urlArray[1];
			let xhr = new XMLHttpRequest(),
				url = 'api/usuarios/'+busqueda;

			xhr.open('GET',url,true);

			xhr.onerror = function(){
				console.log('Error en consultar los usuarios');
			};

			xhr.onload = function(){
				let objJava = JSON.parse(xhr.responseText);
				if(objJava.DISPONIBLE){
					document.querySelector('#textArticulo').value = busqueda;
				}else {
					nVendedor = busqueda;
					nVendedor= document.querySelector('#nameVendedor').value = busqueda;
				}
			};
			hacerBusqueda("?t="+busqueda,'-');
			xhr.send();
		}else{

		}
	}
}


function hacerBusqueda(peti,idCat){
	let texto = document.getElementById('textArticulo').value,
		vended= document.getElementById('nameVendedor').value,
		bs    = document.getElementById('botonSeguidos').checked,
		bv    = document.getElementById('botonVenta').checked,
		cat   = document.getElementById('lista-categorias').value,
		desde = document.getElementById('pDesde').value,
		hasta = document.getElementById('pHasta').value;

	let peticion = peti;

	if(texto){
		peticion += "?t="+texto;
	}
	if(vended){
		peticion += "&v="+vended;
	}
	if(cat!="-"){
		peticion += "&c="+idCat;
	}
	if(bs){
		peticion += "&mios";
	}
	if(bv){
		peticion += "&siguiendo";
	}
	if(desde){
		peticion += "&pd="+desde;
	}
	if(hasta){
		peticion += "&ph="+hasta;
	}

	console.log("Peticion: "+peticion);
	let xhr = new XMLHttpRequest(),
		url = 'api/articulos'+peticion;

	xhr.open('GET',url,true);

	xhr.onerror = function(){
		console.log('Error buscar articulos');
	}

	xhr.onload = function(){
		console.log(JSON.parse(xhr.responseText));
	}

	xhr.send();
<<<<<<< HEAD

	return false;
}
=======
}
>>>>>>> David
